# SQL 문장 살펴 보기

## 01 SELECT문
```sql
SELECT * 혹은 컬럼
FROM [스키마.]테이블명 혹은 [스키마.]뷰명
WHERE 조건
ORDER BY 컬럼;
```

## 02 INSERT문

### 기본 형태
```sql
INSERT INTO [스키마.]테이블명 (컬럼1,컬럼2,...)
VALUES (값1,값2,...);
```

### 컬럼명 기술생략 형태
```sql
INSERT [스키마.]테이블명
VALUES (값1,값2,...);
```

### INSERT ~ SELECT 형태
```sql
INSERT INTO [스키마.]테이블명 (컬럼1,컬럼2,...)
SELECT 문;
```

### UPDATE문
```sql
UPDATE [스키마.]테이블명
SET 컬럼1 = 변견값1,
컬럼2 = 변경값2,
...
WHERE 조건;
```

### MERGE문
- 조건을 비교하여 해당 조건에 맞는 데이터가 없으면 INSERT, 있으면 UPDATE를 수행한다.
```sql
MERGE INTO [스키마.]테이블명
    USING (update나 insert될 데이터 원천)
        ON (update될 조건)
WHEN MATCHED THEN
    SET 컬럼1 = 값1, 컬럼2 = 값2, ...
WHERE update 조건
    DELETE WHERE update_delete 조건
WHEN NOT MATCHED THEN

```
```sql
MERGE INTO ex3_3 d
    USING (SELECT employee_id, salary, manager_id
            FROM employees
            WHERE manager_id = 146) b
            ON(d.employee_id = b.employee_id)
    WHEN MATCHED THEN
        UPDATE SET d.bonus_amt = d.bonus_amt + b.salary * 0.01
    WHEN NOT MATCHED THEN
        INSERT (d.employee_id, d.bonus_amt) values (b.employee_id,b.salary *.001)
        WHERE (b.salary < 8000);
```

## 05 DELETE문
1. 일반 구문
```sql
DELETE [FROM] [스키마.]테이블명
WHERE delete 조건;
```
2. 특정 파티션만 삭제할 경우의 구문
```sql
DELETE [FROM] [스키마.]테이블명 PARTITION (파티션명)
WHERE delete 조건;
```

## 06 COMMIT과 ROLLBACK TRUNCATE
- COMMIT은 변경한 데이터를 데이터베이스에 마지막으로 반영하는 역할
- ROLLBACK은 그 반대로 변경한 데이터를 변경하기 이전 상태로 되돌리는 역할
```sql
COMMIT [WORK] [TO SAVEPOINT 세이트포인트명];

ROLLBACK [WORK] [TO SAVEPOINT 세이브포인트명];
```

- TRUNCATE문에는 ROLLBACK를 실행하더라도 삭제된 데이터가 복구되지 않고 WHERE조건을 붙일 수 없다.
```sql
TRUNCATE TABLE [스키마명.]테이블명;
```

## 07 의사컬럼
- 테이블의 컬럼처럼 동작하지만 실제로 테이블에 저장되지는 않는 컬럼
- SELECT문에서는 의사컬럼을 사용할 수 잇지만 의사컬럼 값을 INSERT,UPDATE,DELETE 할 수는 없다.

- 대표적인 의사 컬럼 종류
    1. CONNECT_BY_ISCYCLE, CONNECT_BY_ISLEAF,LEVEL
        - 계층형 쿼리에서사용하는 의사컬럼
    2. NEXTVAL, CURRVAL
        - 시퀀스에서 사용하는 의사컬럼
    3. ROWNUM,ROWID
        - 각 쿼리에서 반환되는 각 로우들에 대한 순서 값을 나타내는 의사컬럼
        - B-tree 인덱스에서 해당 테이블 로우를 찾아가기 위한 주소 정보가 바로 ROWID이다.

## 08 연산자
- 수식 연산자 : +,-,*,/
- 문자 연산자 : ||
- 논리 연산자 : >,<,>=,<=,=,<>,!=,^=
- 집합 연산자 : UNION, UNION ALL, INTERSECT, MINUS
- 계층형 쿼리 연산자 : PRIOR, CONNECT_BY_ROOT

## 09 표현식
- 표현식이랑 한 개 이상의 값과 연산자, SQL 함수 등이 결합된 식
- CASE 표현식
```sql
CASE WHEN 조건1 THEN 값1
    WHEN 조건2 THEN 값2
...
    ELSE 기타 값
END
```
- 사원 테이블에서 각 사원의 급여에 따라 5000 이하로 급여를 받는 사원은 C, 5000~15000은 B, 15000 이상은 A등급을 반환하는 쿼리

```sql
SELECT employee_id, salary,
    CASE WHEN salary<=5000 THEN "C등급"
        WHEN salary >=5000 AND salary <=15000 THEN "B등급"
        WHEN salary >= 15000 THEN "A등급"
    END AS salary_grade
```
- THEN 이하 출력 값들의 데이터 타입은 반드시 일치시켜야 한다

## 10 조건식
- 조건 혹은 조건식은 한 개 이상의 표현식과 논리 연산자가 결합된 식으로 TRUE, FALSE, UNKNOWN 세 가지 타입을 반환한다

- 비교 조건식
    - 논리 연산자나 ANY,SOME, ALL 키워드로 비교하는 조건식

    1. ANY
    ```sql
    SELECT employee_id, salary
    FROM employees
    WHERE salary = ANY (2000,3000,4000)
    ORDER BY employee_id;
    ```
    - 위 문장은 급여가 2000,3000,4000 중 하나라도 일치하는 모든 사원을 추출한 것. 따라서 ANY는 OR 조건으로도 변환이 가능하다.

    2. ALL
    ```sql
    SELECT employee_id,salary
    FROM employees
    WHERE salary = ALL(2000,3000,4000)
    ORDER BY employee_id;
    ```
    - 반면에 ALL은 모든 조건을 동시에 충족해야 하므로 결과 행이 없다. AND 조건으로 변환이 가능하다

    3. SOME

    - ANY와 동일하게 사용되며 동작한다.

- 논리 조건식
    - 조건절에서 AND,OR NOT을 사용하는 조건식을 말한다

- NULL 조건식
    - NULL 여부는 IS NULL과 IS NOT NULL로 체크한다

- BETWEEN AND 조건식
    - 범위에 해당되는 값을 찾을 때 사용
    - <=와 >= 논리 연산자로 변환 가능

- IN 조건식
    - 조건절에 명시한 값이 포함되는 건을 반환 ANY와 비슷
    - 단 ANY는 등호 연산자 뿐 아니라 >,>=,<,<=,<>,!= 등의 비교 연산자도 사용할 수 있다.

- EXISTS 조건식
    - IN과 비슷하나 후행 조건절로 값의 리스트가 아닌 서브쿼리만 올 수 있다.
    - 또한 서브 쿼리 내에서 조인 조건(a.department_id = b.department_id)이 있어야 한다.

- LIKE 조건식
    - 문자열의 패턴을 검색할 때 사용하는 조건식, 검색 시에 대소문자를 구분한다.
    - EX) LIKE 'A%' %는 글자 전체를 대체한다.
    - EX) LIKE 'A_' _는 글자 하나를 대체한다.

